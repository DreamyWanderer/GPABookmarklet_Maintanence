<html>
    <head>
        <title>HCMUS GPA Calculator</title>
        <link href="default.css" type="text/css" rel="stylesheet">
    </head>
    <body>
         <div class="class2 memberprofile"> 
             <br>
             <br> 
             <br>
        <h2>KHTN GPA Calculator Bookmarklet for Mobile</h2>
     

        <ul>
            <li>B1. Nhấn và giữ vào nút <b>"Khtn GPA"</b> bên dưới, chọn <b>Copy link address</b>, hay <b>Sao chép địa chỉ liên kết</b></li>
            <li>B2. Nhấn <b>Menu (dấu 3 chấm) </b>sau đó nhấn <b>Thêm Bookmark (biểu tượng ngôi sao)</li>
                <li>B3. Nhấn <b>edit/sửa</b> ở thông báo vừa hiện ra, sau đó thay đổi tên <b>Bookmark</b> thành <b>GPA</b> (hay bất cứ tên nào gợi nhớ) </li><li>và <b>Địa chỉ liên kết</b> là địa chỉ đã sao chép ở B1</li>
            <li>B4. Tới trang tra cứu kết quả của <b>Portal</b></li>
            <li>B5. Nhấn chọn "<b>Tất cả</b>", sau đó nhấn nút "<b>Xem Kết Quả</b>"</li>
            <li>B6. Nhập "<b>GPA</b>" (tên mà bạn đã lưu ở B2) vào thanh địa chỉ, và nhấn vào <b>bookmark</b> hiện ra</li>
            <li> Xong :D</li>
        </ul>
        <br>
        <br>
        <a class="back" href="javascript: (function() {
            console.clear();
        
            const currentHref = window.location.href;
            const dkhpReg = /.portal([1-9]|)\.hcmus\.edu\.vn\/SinhVien\.aspx\?(.*)pid=211/;
            let tab;
            if(!currentHref.match(dkhpReg)) {
                const portalReg = /.portal([1-9]|)\.hcmus\.edu\.vn/;
                if(currentHref.match(portalReg)) {
                    alert(&#x22;Vui l&#xF2;ng &#x111;i t&#x1EDB;i trang \&#x22;Tra c&#x1EE9;u K&#x1EBF;t qu&#x1EA3; h&#x1ECD;c t&#x1EAD;p\&#x22; tr&#x1B0;&#x1EDB;c&#x22;);
                     } return;
            };
            WebForm_DoPostBackWithOptions(new WebForm_PostBackOptions(&#x22;ctl00$ContentPlaceHolder1$ctl00$btnXemDiemThi&#x22;, &#x22;&#x22;, true, &#x22;&#x22;, &#x22;&#x22;, false, false));
             tab = $(&#x22;#tbDiemThiGK&#x22;);
            const exceptCourses = [
                &#x22;Anh v&#x103;n&#x22;,
                &#x22;Gi&#xE1;o d&#x1EE5;c qu&#x1ED1;c ph&#xF2;ng&#x22;,
                &#x22;Th&#x1EC3; d&#x1EE5;c&#x22;
            ];
        
            if (tab) {
                let mainTable = tab[0];
                let rows = tab.find(&#x22;tbody tr&#x22;);
                let data = [];
                let exceptData = [];
                for (let i = 0; i &#x3C; rows.length; i++) {
                    const tds = $(rows[i]).find(&#x22;td&#x22;).not(&#x22;.gpa-checkbox&#x22;);
        
                    let row = {
                        id: i + 1,
                        semester: $(tds[0]).text().trim().normalize(),
                        course: $(tds[1]).text().trim().normalize(),
                        credit: parseInt($(tds[2]).text().trim().normalize()),
                        class: $(tds[3]).text().trim().normalize(),
                        ldcode: $(tds[4]).text().trim().normalize(),
                        score: parseFloat($(tds[5]).text().trim().normalize()),
                        note: $(tds[6]).text().trim().normalize(),
                        include: true,
                        whyExclude: &#x22;&#x22;
                    };
        
                    if(!row.credit) {row.credit = 0;
                    row.include = false;
                    row.whyExclude += &#x22;H&#x1ECD;c ph&#x1EA7;n kh&#xF4;ng t&#xED;n ch&#x1EC9;&#x22;;
                    }
                    else if(!row.score) {row.score = 0;
                    row.include = false;
                    row.whyExclude +=&#x22;Ch&#x1B0;a ho&#x1EB7;c kh&#xF4;ng c&#xF3; &#x111;i&#x1EC3;m&#x22;;
                    }
                    else if (row.score &#x3C; 5) {
                        row.include = false;
                        row.whyExclude += &#x22;&#x110;i&#x1EC3;m nh&#x1ECF; h&#x1A1;n 5, ch&#x1B0;a qua m&#xF4;n. &#x22;;
                    } else {
                        let include = true;
                        for (let j = 0; j &#x3C; exceptCourses.length; j++) {
                            if (row.course.includes(exceptCourses[j])) {
                                include = false;
                                row.whyExclude += &#x22;H&#x1ECD;c ph&#x1EA7;n kh&#xF4;ng t&#xED;nh trong GPA. &#x22;;
                                break;
                            }
                        };
                        row.include = include;
                    }
        
                    for (let j = 0; j &#x3C; data.length; j++) {
                        if (data[j].course == row.course) {
                            data[j].include = false;
                            if(!data[j].whyExclude.includes(&#x22;&#x110;&#xE3; h&#x1ECD;c l&#x1EA1;i&#x22;))
                            data[j].whyExclude += &#x22;&#x110;&#xE3; h&#x1ECD;c l&#x1EA1;i. &#x22;;
                        }
                    }
        
                    data.push(row);
        
                    if (!row.include)
                        exceptData.push(row);
                }
        
                let totalCredits = 0;
                let totalScores = 0;
                let gpa = 0;
                let howICalculated = &#x22;%c &#x110;i&#x1EC3;m t&#xED;nh th&#x1EBF; n&#xE0;o nh&#x1EDF; ?%c \n\n&#x22;;
                let cssLog = [&#x22;font-size:16px&#x22;, &#x22;font-size:normal&#x22;];
        
                for (let i = 0; i &#x3C; data.length; i++) {
                    let item = data[i];
                    if (item.include) {
                        totalCredits += item.credit;
                        totalScores += item.credit * item.score;
                        howICalculated += &#x22; &#x22; + item.course + &#x22;:%c &#x22; + item.score + &#x22;%c x%c &#x22; + item.credit + &#x22;%c =%c &#x22; + item.credit * item.score + &#x22;%c \n&#x22;;
                        cssLog.push(&#x22;font-weight:bold;&#x22;);
                        cssLog.push(&#x22;font-weight:normal;&#x22;);
                        cssLog.push(&#x22;font-weight:bold;&#x22;);
                        cssLog.push(&#x22;font-weight:normal;&#x22;);
                        cssLog.push(&#x22;font-weight:bold;&#x22;);
                        cssLog.push(&#x22;font-weight:normal;&#x22;);
                    } else {
                        howICalculated += &#x22;%c &#x22; + item.course + &#x22;: &#x22; + item.score + &#x22; x &#x22; + item.credit + &#x22;%c \n&#x22;;
                        cssLog.push(&#x22;color:orange;text-decoration: line-through;&#x22;);
                        cssLog.push(&#x22;color:black;&#x22;);
                    }
                }
                gpa = totalScores / totalCredits;
        
                let removedCoursesSize= 0;
                for(let i =0;i&#x3C; data.length;i++)
                if(!data[i].include) removedCoursesSize++;
                console.log(&#x22;%c \n Ch&#xE0;o nh&#xE9;, GPA n&#xE8;:\n %c&#x22; + gpa + &#x22;\n&#x22;, &#x22;color:black&#x22;, &#x22;color:blue; font-size: 30px;&#x22;);
                console.log(&#x22;%c \n T&#x1ED5;ng t&#xED;n ch&#x1EC9;:\n %c&#x22; + totalCredits + &#x22;\n&#x22;, &#x22;color:black&#x22;, &#x22;color:blue; font-size: 30px;&#x22;);
                console.log(&#x22;%c \n T&#x1ED5;ng &#x111;i&#x1EC3;m:\n %c&#x22; + totalScores + &#x22;\n&#x22;, &#x22;color:black&#x22;, &#x22;color:blue; font-size: 30px;&#x22;);
                console.log(&#x22;%c \n T&#x1ED5;ng h&#x1ECD;c ph&#x1EA7;n:\n %c&#x22; + data.length + &#x22;\n&#x22;, &#x22;color:black&#x22;, &#x22;color:blue; font-size: 30px;&#x22;);
                console.log(&#x22;%c \n T&#x1ED5;ng h&#x1ECD;c ph&#x1EA7;n trong GPA:\n %c&#x22; + (data.length - removedCoursesSize) + &#x22;\n&#x22;, &#x22;color:black&#x22;, &#x22;color:blue; font-size: 30px;&#x22;);
        
                howICalculated += &#x22;-------------\n&#x22; + &#x22;GPA : %c &#x22; + totalScores + &#x22; / &#x22; + totalCredits + &#x22; = &#x22; + gpa;
                cssLog.push(&#x22;font-weight:bold&#x22;);
        
        
                let removedSection = &#x22;%c Kh&#xF4;ng bao g&#x1ED3;m nh&#x1EEF;ng h&#x1ECD;c ph&#x1EA7;n sau &#x111;&#xE2;y: \n\n%c&#x22;;
                let removedCss = [&#x22;font-size:16px&#x22;, &#x22;font-size:normal&#x22;];
        
                for (let i = 0; i &#x3C; exceptData.length; i++) {
                    removedSection += &#x22;%c  lo&#x1EA1;i b&#x1ECF;: %c&#x22; + exceptData[i].course + &#x22; (&#x22; + exceptData[i].semester + &#x22;)&#x22; + &#x22;\n%c l&#xFD; do: %c&#x22; + exceptData[i].whyExclude + &#x22;\n\n%c&#x22;;
                    removedCss.push(&#x22;color:black&#x22;);
                    removedCss.push(&#x22;color:blue&#x22;);
                    removedCss.push(&#x22;color:black&#x22;);
        
                    removedCss.push(&#x22;color:red&#x22;);
                    removedCss.push(&#x22;color:black&#x22;);
                }
        
               
        
                removedSection += &#x22;%c  &#x22; + removedCoursesSize + &#x22; h&#x1ECD;c ph&#x1EA7;n &#x111;&#xE3; lo&#x1EA1;i b&#x1ECF;.%c\n&#x22;;
                removedCss.push(&#x22;color:red&#x22;);
                removedCss.push(&#x22;color:black&#x22;);
        
                console.log(removedSection, ...removedCss);
                console.log(howICalculated, ...cssLog);
        
                console.log(&#x22;(K&#xE9;o l&#xEA;n &#x111;&#x1EC3; xem chi ti&#x1EBF;t)&#x22;);
        
        
                let headTr = tab.find(&#x22;thead tr&#x22;)[0];
        
                if ($(headTr).find(&#x22;th&#x22;).length &#x3C; 8) {
        
                    let headTh = $($(headTr).find(&#x22;th&#x22;)[0]).clone();
                    $(headTh).attr(&#x22;title&#x22;, &#x22;T&#xED;nh hay kh&#xF4;ng t&#xED;nh h&#x1ECD;c ph&#x1EA7;n n&#xE0;y trong GPA&#x22;);
                    $(headTh).children().html(&#x22;Trong GPA&#x22;);
        
                    $(headTr).prepend(headTh);
        
                    for (let i = 0; i &#x3C; rows.length; i++) {
                        $(rows[i]).prepend(&#x27;&#x3C;td class= &#x22;center gpa-checkbox&#x22; style=&#x22;width:60px;&#x22; &#x3E;&#x3C;input type=&#x22;checkbox&#x22;&#x27; + ((data[i].include) ? &#x22; checked &#x22; : &#x22;&#x22;) + &#x27; /&#x3E;&#x3C;/td&#x3E;&#x27;);
                       
                        if(!data[i].include) {
                            if(data[i].whyExclude.includes(&#x22;kh&#xF4;ng t&#xED;nh&#x22;))
                            $(rows[i]).attr(&#x22;style&#x22;,&#x22;color:blue;text-decoration: line-through;&#x22;);
                            else
                            $(rows[i]).attr(&#x22;style&#x22;,&#x22;color:red;text-decoration: line-through;&#x22;);
                        }
                    }
        
                    let parentDiv = $(&#x22;#lich-thi-dkhp&#x22;)[0];
                    let gpaFieldSet = $(&#x27;&#x3C;fieldset&#x3E;&#x3C;legend&#x3E;Th&#x1ED1;ng k&#xEA; GPA&#x3C;/legend&#x3E;&#x3C;div id=&#x22;tbGPA_wrapper&#x22; class=&#x22;dataTables_wrapper&#x22; rold=&#x22;grid&#x22;&#x3E;&#x3C;table id=&#x22;tbGPA&#x22; class=&#x22;dkhp-table dataTable&#x22;&#x3E;&#x3C;thead&#x3E;&#x3C;/thead&#x3E;&#x3C;tbody role=&#x22;alert&#x22; aria-live=&#x22;polite&#x22; aria-relevant=&#x22;all&#x22;&#x3E;&#x3C;/tbody&#x3E;&#x3C;/table&#x3E;&#x3C;/div&#x3E;&#x3C;p style=&#x22;margin-top: 10px; color: blue;&#x22;&#x3E;&#x3C;strong&#x3E;(*)&#x3C;/strong&#x3E;: Nh&#x1EA5;n Ctr+Shift+I v&#xE0; ch&#x1ECD;n tab Console &#x111;&#x1EC3; xem chi ti&#x1EBF;t t&#xED;nh to&#xE1;n.&#x3C;/p&#x3E;&#x3C;/fieldset&#x3E;&#x27;);
                    let gpaTableHead = $(gpaFieldSet).find(&#x22;thead&#x22;)[0];
                    let gpaTableBody = $(gpaFieldSet).find(&#x22;tbody&#x22;)[0];
        
                    const gpaHeadCol1 =  $($(headTr).find(&#x22;th&#x22;)[2]).clone();
                    $(gpaHeadCol1).attr(&#x22;title&#x22;,&#x22;T&#xEA;n m&#x1EE5;c&#x22;);
                    $(gpaHeadCol1).children().html(&#x22;T&#xEA;n m&#x1EE5;c&#x22;);
        
                    const gpaHeadCol2 = headTh.clone();
                    $(gpaHeadCol2).attr(&#x22;title&#x22;,&#x22;Gi&#xE1; tr&#x1ECB;&#x22;);
                    $(gpaHeadCol2).children().html(&#x22;Gi&#xE1; tr&#x1ECB;&#x22;);
        
                    $(gpaTableHead).append(gpaHeadCol1);
                    $(gpaTableHead).append(gpaHeadCol2);
        
                    $(gpaTableBody).append(&#x27;&#x3C;tr class=&#x22;odd&#x22;&#x3E;&#x3C;td class=&#x22;left &#x22;&#x3E;GPA&#x3C;/td&#x3E;&#x3C;td class=&#x22;center gpa&#x22;&#x3E;&#x27;+gpa+&#x27;&#x3C;/td&#x3E;&#x3C;/tr&#x3E;&#x27;);
                    $(gpaTableBody).append(&#x27;&#x3C;tr class=&#x22;even&#x22;&#x3E;&#x3C;td class=&#x22;left&#x22;&#x3E;T&#x1ED5;ng t&#xED;n ch&#x1EC9; &#x111;&#xE3; t&#xED;ch lu&#x1EF9;&#x3C;/td&#x3E;&#x3C;td class=&#x22;center gpa&#x22;&#x3E;&#x27;+totalCredits+&#x27; t&#xED;n ch&#x1EC9;&#x3C;/td&#x3E;&#x3C;/tr&#x3E;&#x27;);
                    $(gpaTableBody).append(&#x27;&#x3C;tr class=&#x22;odd&#x22;&#x3E;&#x3C;td class=&#x22;left&#x22;&#x3E;T&#x1ED5;ng &#x111;i&#x1EC3;m &#x111;&#xE3; t&#xED;ch l&#x169;y&#x3C;/td&#x3E;&#x3C;td class=&#x22;center gpa&#x22;&#x3E;&#x27;+totalScores+&#x27; &#x111;i&#x1EC3;m&#x3C;/td&#x3E;&#x3C;/tr&#x3E;&#x27;);
                    $(gpaTableBody).append(&#x27;&#x3C;tr class=&#x22;even&#x22;&#x3E;&#x3C;td class=&#x22;left&#x22;&#x3E;S&#xF4; h&#x1ECD;c ph&#x1EA7;n &#x111;&#xE3; h&#x1ECD;c&#x3C;/td&#x3E;&#x3C;td class=&#x22;center gpa&#x22;&#x3E;&#x27;+data.length+&#x27; h&#x1ECD;c ph&#x1EA7;n&#x3C;/td&#x3E;&#x3C;/tr&#x3E;&#x27;);
                    $(gpaTableBody).append(&#x27;&#x3C;tr class=&#x22;odd&#x22;&#x3E;&#x3C;td class=&#x22;left&#x22;&#x3E;S&#x1ED1; h&#x1ECD;c ph&#x1EA7;n t&#xED;nh trong GPA&#x3C;/td&#x3E;&#x3C;td class=&#x22;center gpa&#x22;&#x3E;&#x27;+(data.length - removedCoursesSize)+&#x27; h&#x1ECD;c ph&#x1EA7;n&#x3C;/td&#x3E;&#x3C;/tr&#x3E;&#x27;);
            
                    $(parentDiv).prepend(gpaFieldSet);
                } else {
                    
                    for(let i = 0;i &#x3C;rows.length;i++) {
                        if(data[i].include)
                        $($(rows[i]).find(&#x22;input&#x22;)[0]).attr(&#x27;checked&#x27;, &#x27;checked&#x27;);
                        else $($(rows[i]).find(&#x22;input&#x22;)[0]).removeAttr(&#x27;checked&#x27;);
                    }
        
                }
        
        
        
            } else alert(&#x22;Xin l&#x1ED7;i, kh&#xF4;ng th&#x1EC3; ph&#xE2;n t&#xED;ch website&#x22;);
        }
        
        )();"> Khtn GPA </a>
        <br>
        <br>
        <hr>
        <a class="back" href="index.html"> Hướng dẫn chạy trên máy tính ></a>
        <br>
        <br>
        <br>
        <a class="back" href="https://portal6.hcmus.edu.vn/SinhVien.aspx?pid=211" target="_blank"> Đi tới Portal ></a>
        </div>
    </body>
</html>