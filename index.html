<html>
    <head>
        <title>Tính Gpa giùm bạn (KHTN-only)</title>
        <link href="default.css" type="text/css" rel="stylesheet">
    </head>
    <body>
         <div class="class2 memberprofile"> 
             <br>
             <br> 
             <br>
        <h2>KHTN GPA Calculator Bookmarklet</h2>
        <ul>
            <li>B1. Nếu thanh bookmark của trình duyệt đang ẩn, nhấn Ctrl+Shift+B để nó hiện lên</li>
            <li>B2. Nhấn và giữ phím chuột vào nút <b>"Khtn GPA"</b> bên dưới</li>
            <li>B3. <b>Kéo chuột</b> vào thanh <b>Bookmark</b> của trình duyệt</li>
            <li>B4. Tới trang <b>Tra cứu kết quả</b> của <b>Portal</b></li>
            <li>B5. <b>Bấm</b> vào <b>bookmark</b> bạn đã tạo ở bước 2</li>
            <li> Xong :D</li>
        </ul>
        <br>
        <br>
        <a class="back" href="javascript: (function gpa() { console.clear() const currentHref = window.location.href; const dkhpReg = /.portal([1-9]|)\.hcmus\.edu\.vn\/SinhVien\.aspx\?(.*)pid=211/; if (!currentHref.match(dkhpReg)) { const portalReg = /.portal([1-9]|)\.hcmus\.edu\.vn/; if (currentHref.match(portalReg)) { alert(&quot;Vui lòng đi tới trang \&quot;Tra cứu Kết quả học tập\&quot; trước&quot;); } return; }; var dataArray = $(&quot;#aspnetForm&quot;).serializeArray(); var param = dataArray.reduce(function (a, x) { a[x.name] = x.value; return a; }, {});; const isAllSection = param['ctl00$ContentPlaceHolder1$ctl00$cboNamHoc_gvDKHPLichThi$ob_CbocboNamHoc_gvDKHPLichThiTB'] == '--Tất cả--'; let semeterInput = $('input[name=&quot;ctl00$ContentPlaceHolder1$ctl00$cboHocKy_gvDKHPLichThi$ob_CbocboHocKy_gvDKHPLichThiTB&quot;]'); if (semeterInput) semeterInput = semeterInput[0]; else return; const isSemeterDisabled = $(semeterInput).attr('disabled') || $(semeterInput).prop('disabled'); if (!isAllSection || isSemeterDisabled) { param['ctl00$ContentPlaceHolder1$ctl00$cboNamHoc_gvDKHPLichThi$ob_CbocboNamHoc_gvDKHPLichThiTB'] = '--Tất cả--'; param['ctl00$ContentPlaceHolder1$ctl00$cboNamHoc_gvDKHPLichThi$ob_CbocboNamHoc_gvDKHPLichThiSIS'] = '0'; param['ctl00$ContentPlaceHolder1$ctl00$cboNamHoc_gvDKHPLichThi'] = '0'; param['ctl00$ContentPlaceHolder1$ctl00$cboHocKy_gvDKHPLichThi$ob_CbocboHocKy_gvDKHPLichThiTB'] = '0'; param['ctl00$ContentPlaceHolder1$ctl00$cboHocKy_gvDKHPLichThi$ob_CbocboHocKy_gvDKHPLichThiSIS'] = '0'; param['ctl00$ContentPlaceHolder1$ctl00$cboHocKy_gvDKHPLichThi'] = '1'; param['ctl00$ContentPlaceHolder1$ctl00$btnXemDiemThi'] = 'Xem Kết Quả Học Tập'; const parentDiv = $(&quot;#lich-thi-dkhp&quot;)[0]; if (parentDiv && !$(&quot;#loading-text&quot;)[0]) parentDiv.prepend($('&lt;div id=&quot;loading-text&quot; style=&quot;font-size:20px; color:#1B486A;text-align:center;margin:10px;&quot;>Chờ một chút...&lt;/div>')[0]); $.ajax({ type: &quot;POST&quot;, url: &quot;/SinhVien.aspx?pid=211&quot;, data: param, success: function (res) { let html = $.parseHTML(res); let HK = $(html).find(&quot;input[name='ctl00$ContentPlaceHolder1$ctl00$cboNamHoc_gvDKHPLichThi$ob_CbocboNamHoc_gvDKHPLichThiTB']&quot;); if (HK) console.log($(HK[0]).attr(&quot;value&quot;)); var newDoc = document.open(&quot;text/html&quot;, &quot;replace&quot;); newDoc.write(res); newDoc.close(); gpa(); }, }); return; } let tab = $(&quot;#tbDiemThiGK&quot;); let exceptData = []; let data = []; let rows = null; function initUserCourseData() { const exceptCourses = [ &quot;Anh văn&quot;, &quot;Giáo dục quốc phòng&quot;, &quot;Thể dục&quot;, &quot;Anh van&quot;, &quot;Giao duc quoc phong&quot;, &quot;The duc&quot; ]; if (tab) { let mainTable = tab[0]; rows = tab.find(&quot;tbody tr&quot;); for (let i = 0; i &lt; rows.length; i++) { const tds = $(rows[i]).find(&quot;td&quot;).not(&quot;.gpa-checkbox&quot;); let row = { id: i + 1, semester: $(tds[0]).text().trim().normalize(), course: $(tds[1]).text().trim().normalize(), credit: parseInt($(tds[2]).text().trim().normalize()), class: $(tds[3]).text().trim().normalize(), ldcode: $(tds[4]).text().trim().normalize(), score: parseFloat($(tds[5]).text().trim().normalize()), note: $(tds[6]).text().trim().normalize(), include: true, whyExclude: &quot;&quot;, isAbsent: $(tds[5]).text().trim().normalize() == &quot;Vắng&quot; }; $(rows[i]).attr(&quot;id&quot;, row.id); // Get id of course in table even if it is sorted if (!row.credit) { row.credit = 0; row.include = false; row.whyExclude += &quot;Học phần không tín chỉ&quot;; } else if (row.isAbsent) { row.score = 0; row.include = false; row.whyExclude += &quot;Điểm nhỏ hơn 5, chưa qua môn. &quot;; } else if (!row.score) { row.score = 0; row.include = false; row.whyExclude += &quot;Chưa hoặc không có điểm&quot;; } else if (row.score &lt; 5 || row.isAbsent) { row.include = false; row.whyExclude += &quot;Điểm nhỏ hơn 5, chưa qua môn. &quot;; } else { let include = true; for (let j = 0; j &lt; exceptCourses.length; j++) { if (row.course.includes(exceptCourses[j])) { include = false; row.whyExclude += &quot;Học phần không tính trong GPA. &quot;; break; } }; row.include = include; } for (let j = 0; j &lt; data.length; j++) { if (data[j].course == row.course) { data[j].include = false; data[j].whyExclude = &quot;Đã học lại. &quot;; } } data.push(row); if (!row.include) exceptData.push(row); } } } function calculateGPA() { console.clear(); let totalCredits = 0; let notPassCredits = 0; let totalScores = 0; let notPassTotalScore = 0; let gpa = 0; let notPassGPA = 0; let howICalculated = &quot;%c Điểm tính thế nào nhở ?%c \n\n&quot;; let cssLog = [&quot;font-size:16px&quot;, &quot;font-size:normal&quot;]; for (let i = 0; i &lt; data.length; i++) { let item = data[i]; if (item.include) { totalCredits += item.credit; totalScores += item.credit * item.score; howICalculated += &quot; &quot; + item.course + &quot;:%c &quot; + item.score + &quot;%c x%c &quot; + item.credit + &quot;%c =%c &quot; + item.credit * item.score + &quot;%c \n&quot;; cssLog.push(&quot;font-weight:bold;&quot;); cssLog.push(&quot;font-weight:normal;&quot;); cssLog.push(&quot;font-weight:bold;&quot;); cssLog.push(&quot;font-weight:normal;&quot;); cssLog.push(&quot;font-weight:bold;&quot;); cssLog.push(&quot;font-weight:normal;&quot;); } else { if (item.whyExclude.includes(&quot;5&quot;)) // Used to calculate even not passed gpa { console.log(item); notPassCredits += item.credit; notPassTotalScore += item.credit * item.score; } howICalculated += &quot;%c &quot; + item.course + &quot;: &quot; + item.score + &quot; x &quot; + item.credit + &quot;%c \n&quot;; cssLog.push(&quot;color:orange;text-decoration: line-through;&quot;); cssLog.push(&quot;color:black;&quot;); } } gpa = totalScores / totalCredits; notPassGPA = (totalScores + notPassTotalScore) / (totalCredits + notPassCredits); let removedCoursesSize = 0; for (let i = 0; i &lt; data.length; i++) if (!data[i].include) removedCoursesSize++; console.log(&quot;%c \n Chào nhé, GPA nè:\n %c&quot; + gpa + &quot;\n&quot;, &quot;color:black&quot;, &quot;color:blue; font-size: 30px;&quot;); console.log(&quot;%c \n Tổng tín chỉ:\n %c&quot; + totalCredits + &quot;\n&quot;, &quot;color:black&quot;, &quot;color:blue; font-size: 30px;&quot;); console.log(&quot;%c \n Tổng điểm:\n %c&quot; + totalScores + &quot;\n&quot;, &quot;color:black&quot;, &quot;color:blue; font-size: 30px;&quot;); console.log(&quot;%c \n Tổng học phần:\n %c&quot; + data.length + &quot;\n&quot;, &quot;color:black&quot;, &quot;color:blue; font-size: 30px;&quot;); console.log(&quot;%c \n Tổng học phần trong GPA:\n %c&quot; + (data.length - removedCoursesSize) + &quot;\n&quot;, &quot;color:black&quot;, &quot;color:blue; font-size: 30px;&quot;); howICalculated += &quot;-------------\n&quot; + &quot;GPA : %c &quot; + totalScores + &quot; / &quot; + totalCredits + &quot; = &quot; + gpa; cssLog.push(&quot;font-weight:bold&quot;); let removedSection = &quot;%c Không bao gồm những học phần sau đây: \n\n%c&quot;; let removedCss = [&quot;font-size:16px&quot;, &quot;font-size:normal&quot;]; for (let i = 0; i &lt; exceptData.length; i++) { removedSection += &quot;%c loại bỏ: %c&quot; + exceptData[i].course + &quot; (&quot; + exceptData[i].semester + &quot;)&quot; + &quot;\n%c lý do: %c&quot; + exceptData[i].whyExclude + &quot;\n\n%c&quot;; removedCss.push(&quot;color:black&quot;); removedCss.push(&quot;color:blue&quot;); removedCss.push(&quot;color:black&quot;); removedCss.push(&quot;color:red&quot;); removedCss.push(&quot;color:black&quot;); } removedSection += &quot;%c &quot; + removedCoursesSize + &quot; học phần đã loại bỏ.%c\n&quot;; removedCss.push(&quot;color:red&quot;); removedCss.push(&quot;color:black&quot;); console.log(removedSection, ...removedCss); console.log(howICalculated, ...cssLog); console.log(&quot;(Kéo lên để xem chi tiết)&quot;); } function formatCoursesTableAndCreateResultTable() { let headTr = tab.find(&quot;thead tr&quot;)[0]; let headTh = $($(headTr).find(&quot;th&quot;)[0]).clone(); if ($(headTr).find(&quot;th&quot;).length &lt; 8) { // First time calculate GPA. Insert checkbox column. $(headTh).attr(&quot;title&quot;, &quot;Tính hay không tính học phần này trong GPA&quot;); $(headTh).children().html(&quot;Trong GPA&quot;); $(headTr).prepend(headTh); for (let i = 0; i &lt; rows.length; i++) { $(rows[i]).prepend('&lt;td class= &quot;center gpa-checkbox&quot; style=&quot;width:60px;&quot; >&lt;input type=&quot;checkbox&quot;' + ((data[i].include) ? &quot; checked &quot; : &quot;&quot;) + ' />&lt;/td>'); } } let parentDiv = $(&quot;#lich-thi-dkhp&quot;)[0]; $(&quot;#tbGPA&quot;).remove() let gpaFieldSet = $('&lt;fieldset id=&quot;tbGPA&quot;>&lt;legend>Thống kê GPA&lt;/legend>&lt;div id=&quot;tbGPA_wrapper&quot; class=&quot;dataTables_wrapper&quot; rold=&quot;grid&quot;>&lt;table id=&quot;tbGPA&quot; class=&quot;dkhp-table dataTable&quot;>&lt;thead>&lt;/thead>&lt;tbody role=&quot;alert&quot; aria-live=&quot;polite&quot; aria-relevant=&quot;all&quot;>&lt;/tbody>&lt;/table>&lt;/div>&lt;p style=&quot;margin-top: 10px; color: blue;&quot;>&lt;strong>(*)&lt;/strong>: Nhấn Ctr+Shift+I và chọn tab Console để xem chi tiết tính toán.&lt;br>      Nếu bạn thấy hữu ích, hãy tặng mình một Star &lt;a href=&quot;https://github.com/dtrung98/GPABookmarklet&quot;>Tại Đây&lt;/a> nhé ^^&lt;/p>&lt;/fieldset>'); let gpaTableHead = $(gpaFieldSet).find(&quot;thead&quot;)[0]; let gpaTableBody = $(gpaFieldSet).find(&quot;tbody&quot;)[0]; const gpaHeadCol1 = $($(headTr).find(&quot;th&quot;)[2]).clone(); $(gpaHeadCol1).attr(&quot;title&quot;, &quot;Tên mục&quot;); $(gpaHeadCol1).children().html(&quot;Tên mục&quot;); const gpaHeadCol2 = headTh.clone(); $(gpaHeadCol2).attr(&quot;title&quot;, &quot;Giá trị&quot;); $(gpaHeadCol2).children().html(&quot;Giá trị&quot;); $(gpaTableHead).append(gpaHeadCol1); $(gpaTableHead).append(gpaHeadCol2); $(gpaTableBody).append('&lt;tr class=&quot;odd&quot;>&lt;td class=&quot;left &quot;>Điểm trung bình tích lũy (GPA)&lt;/td>&lt;td class=&quot;center gpa&quot; id=&quot;calGPA&quot;>&lt;b>' + gpa + '&lt;/b>&lt;/td>&lt;/tr>'); $(gpaTableBody).append('&lt;tr class=&quot;odd&quot;>&lt;td class=&quot;left &quot;>Điểm trung bình học tập&lt;/td>&lt;td class=&quot;center gpa&quot; id=&quot;calGPA&quot;>&lt;b>' + notPassGPA + '&lt;/b>&lt;/td>&lt;/tr>'); $(gpaTableBody).append('&lt;tr class=&quot;even&quot;>&lt;td class=&quot;left&quot;>Tổng tín chỉ đã tích luỹ&lt;/td>&lt;td class=&quot;center gpa&quot; id=&quot;calSumCredit&quot;>' + totalCredits + ' tín chỉ&lt;/td>&lt;/tr>'); $(gpaTableBody).append('&lt;tr class=&quot;odd&quot;>&lt;td class=&quot;left&quot;>Tổng điểm đã tích lũy&lt;/td>&lt;td class=&quot;center gpa&quot; id=&quot;sumScore&quot;>' + totalScores + '&lt;/td>&lt;/tr>'); $(gpaTableBody).append('&lt;tr class=&quot;even&quot;>&lt;td class=&quot;left&quot;>Sô học phần đã học&lt;/td>&lt;td class=&quot;center gpa&quot; id=&quot;sumCourse&quot;>' + data.length + ' học phần&lt;/td>&lt;/tr>'); $(gpaTableBody).append('&lt;tr class=&quot;odd&quot;>&lt;td class=&quot;left&quot;>Số học phần tính trong GPA&lt;/td>&lt;td class=&quot;center gpa&quot; id=&quot;sumCalCourse&quot;>' + (data.length - removedCoursesSize) + ' học phần&lt;/td>&lt;/tr>'); $(parentDiv).prepend(gpaFieldSet); for (let i = 0; i &lt; rows.length; i++) { if (!data[i].include) { if (data[i].whyExclude.includes(&quot;không tính&quot;)) $(rows[i]).attr(&quot;style&quot;, &quot;color:blue;text-decoration: line-through;&quot;); else if (data[i].whyExclude == &quot;&quot;) $(rows[i]).attr(&quot;style&quot;, &quot;color:grey;text-decoration: line-through;&quot;); else $(rows[i]).attr(&quot;style&quot;, &quot;color:red;text-decoration: line-through;&quot;); } else { if (data[i].whyExclude == &quot;&quot;) $(rows[i]).removeAttr(&quot;style&quot;); else $(rows[i]).attr(&quot;style&quot;, &quot;color:yellow;text-decoration: line-through;&quot;); } } } initUserCourseData(); calculateGPA(); // Calculate GPA at first time formatCoursesTableAndCreateResultTable(); // When deselect a course, recalculate GPA $('input[type=&quot;checkbox&quot;]').change(function () { let courseRow = $(this).closest(&quot;tr&quot;); let idCourse = $(courseRow).attr(&quot;id&quot;); data[idCourse - 1].include = $(this).is(&quot;:checked&quot;); calculateGPA(); formatCoursesTableAndCreateResultTable(); }) } )();"> Khtn GPA </a>
        <br>
        <br>
        <hr>
        <a class="back" href="guideline_mobile.html"> Hướng dẫn dành cho điện thoại di động ></a>
        <br>
        <br>
        <br>
        <a class="back" href="https://portal6.hcmus.edu.vn/SinhVien.aspx?pid=211" target="_blank"> Đi tới Portal ></a>
        </div>
    </body>
</html>
